---
layout: single
title: "[JPA í”„ë¡œê·¸ë˜ë°] 2. JPA ì‹œì‘ "
excerpt: "JPA í”„ë¡œì íŠ¸ ë§Œë“¤ì–´ ë³´ê¸°"

data: 2023-04-11
last_modified_at: 2023-04-11
---

<br/><br/>

## ğŸ’» ì„¤ì¹˜í•˜ê¸°

1. H2 ë°ì´í„° ë² ì´ìŠ¤ ì„¤ì¹˜ : ì‹¤ìŠµìš© ìµœê³ ì˜ ë°ì´í„° ë² ì´ìŠ¤
2. Intellij IDEA ì„¤ì¹˜: Java 8ë²„ì „ ì´ìƒ, ë©”ì´ë¸ ì„¤ì •(ìë°” ë¼ì´ë¸ŒëŸ¬ë¦¬, ë¹Œë“œ ê´€ë¦¬)

<br/><br/>

## ğŸ“ JPA í”„ë¡œì íŠ¸ ê¸°ë³¸ íŒŒì¼

### <span style="color:#F5B1C8">ğŸ“„ pom.xml</span>

í”„ë¡œì íŠ¸ ê´€ë¦¬ ë° ë¹Œë“œì— í•„ìš”í•œ í™˜ê²½ì„¤ì • ë“±ì„ ê¸°ìˆ 

```
    <project></project>
```

- í”„ë¡œì íŠ¸ ì •ë³´ë¥¼ ê¸°ìˆ í•œë‹¤.

```
    <modelVersion>4.0.0</modelVersion>
    <groupId>jpa-basic</groupId>
    <artifactId>ex1-hello-jpa</artifactId>
    <version>1.0.0</version>
```

- `modelVersion`: mavenì˜ pom.xmlì˜ ëª¨ë¸ ë²„ì „ì´ë‹¤.
- `groupId`: í”„ë¡œì íŠ¸ë¥¼ ìƒì„±í•œ ê·¸ë£¹ëª…ìœ¼ë¡œ ì œì‘ìì™€ íšŒì‚¬, ë‹¨ì²´ ë“±ì„ ì‹ë³„í•˜ê¸° ìœ„í•œ ê²ƒì´ë‹¤.
- `artifactId`: ë²„ì „ ì •ë³´ë¥¼ ìƒëµí•œ íŒŒì¼ ì´ë¦„ì´ë‹¤.

```
<dependencies>
        <!-- JPA í•˜ì´ë²„ë„¤ì´íŠ¸ -->
        <dependency>
            <groupId>org.hibernate</groupId>
            <artifactId>hibernate-entitymanager</artifactId>
            <version>5.3.10.Final</version>
        </dependency>
        <!-- H2 ë°ì´í„°ë² ì´ìŠ¤ -->
        <dependency>
            <groupId>com.h2database</groupId>
            <artifactId>h2</artifactId>
            <version>1.4.199</version>
        </dependency>
</dependencies>
```

- `dependencies`: ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ëª¨ì•„ ê´€ë¦¬í•˜ëŠ” ê³³ì´ë‹¤.
- groupId, artifactIdì€ ìœ„ì˜ ì„¤ëª…ê³¼ ë™ì¼í•˜ë‹¤.

ë‹¨, ë³¸ì¸ì´ ì‚¬ìš©í•˜ëŠ” springê³¼ JPAì˜ í•˜ì´ë²„ë„¤ì´íŠ¸ì™€ ë³¸ì¸ì´ ì‚¬ìš©í•˜ëŠ” h2 ë²„ì „ì„ <span style="background-color:#E3F2FD">í†µì¼ ì‹œí‚¤ëŠ” ê²ƒì´ ì¢‹ë‹¤.</span>

### <span style="color:#0D47A1">ğŸ“„persistence.xml</span>

- JPAì˜ ì„¤ì •íŒŒì¼ì´ë‹¤.
- main/resouresì— META-IN/persistence.xml íŒŒì¼ ìƒì„±

```
<persistence-unit name="hello">
        <properties>
            <!-- í•„ìˆ˜ ì†ì„± -->
            <property name="javax.persistence.jdbc.driver" value="org.h2.Driver"/>
            <property name="javax.persistence.jdbc.user" value="sa"/>
            <property name="javax.persistence.jdbc.password" value=""/>
            <property name="javax.persistence.jdbc.url" value="jdbc:h2:tcp://localhost/~/test"/>
            <property name="hibernate.dialect" value="org.hibernate.dialect.H2Dialect"/>

            <!-- ì˜µì…˜ -->
            <property name="hibernate.show_sql" value="true"/>
            <property name="hibernate.format_sql" value="true"/>
            <property name="hibernate.use_sql_comments" value="true"/>
            <!--<property name="hibernate.hbm2ddl.auto" value="create" />-->
        </properties>
    </persistence-unit>
```

- `persistence-unit`: ê³ ìœ í•œ ì´ë¦„ì„ ë¶€ì—¬í•œë‹¤. EntityManageFactory ìƒì„± ì‹œ unit nameê³¼ ì¼ì¹˜í•´ì•¼ í•œë‹¤.
- `jdbc.url`: DB ì ‘ì† URLìœ¼ë¡œ, h2 ì‹¤í–‰ ì‹œ urlì´ ì¼ì¹˜í•´ì•¼ í•œë‹¤.
- `hibernate.dialect`: DB dialect ì„¤ì •

- `hibernate.show_sql`: ì‹¤í–‰í•œ sqlì„ ë¡œê·¸ë¡œ ì¶œë ¥í•œë‹¤.
- `hibernate.format_sql`: ì‹¤í–‰í•œ sql ì¿¼ë¦¬ë¬¸ì„ ì •ë ¬í•œë‹¤.
- `hibernate.use_sql_comments`: ì¿¼ë¦¬ ì¶œë ¥ì‹œ ì£¼ì„ë¬¸ë„ í•¨ê»˜ ì¶œë ¥ëœë‹¤.
- `hibernate.hbm2ddl.auto`: ë°ì´í„° ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ìë™ ìƒì„±(ì„¹ì…˜ 4.ì—”í‹°í‹° ë§¤í•‘ì—ì„œ ìì„¸íˆ ë‹¤ë£° ì˜ˆì •)

<br/><br/>

## ë°ì´í„° ë² ì´ìŠ¤ ë°©ì–¸

<span style="background-color:#E3F2FD">JPAëŠ” íŠ¹ì • ë°ì´í„° ë² ì´ìŠ¤ì— ì¢…ì†ì ì´ì§€ ì•Šë‹¤.</span>
ë”°ë¼ì„œ ë°ì´í„° ë² ì´ìŠ¤ ë°©ì–¸ í´ë˜ìŠ¤(Dialect)ë¥¼ ì œê³µí•˜ëŠ”ë° í”„ë¡œì íŠ¸ ê°œë°œìëŠ” ì´ì— ëŒ€í•˜ì—¬ ì‚¬ìš©í•˜ëŠ” ë°ì´í„° ë² ì´ìŠ¤ê°€ ë³€ê²½ë˜ì–´ë„ <span style="background-color:#E3F2FD">ë°©ì–¸ë§Œ êµì²´í•˜ë©´ ì‰½ê²Œ DBë¥¼ ë³€ê²½í•  ìˆ˜ ìˆë‹¤.</span>
**ë°©ì–¸(Dialet) ì¢…ë¥˜**: MySQL DB, Oracle DB, H2 DB

<br/><br/>

## JPA êµ¬ë™ ë°©ì‹

![img2](../img/img2.png)

1. persistenceì—ì„œ ì„¤ì • ì •ë³´ë¥¼ ì½ëŠ”ë‹¤.
2. factory í´ë˜ìŠ¤ë¥¼ ë§Œë“ ë‹¤.
3. í•„ìš”í•  ë•Œë§ˆë‹¤ Entry Managerì„ ë§Œë“ ë‹¤.

<br/><br/>

## ê°ì²´ì™€ í…Œì´ë¸” ìƒì„± í›„ ë§¤í•‘í•˜ê¸°

<br/><br/>

ğŸ“„Member.java

```
package hellojpa;

import javax.persistence.Entity;
import javax.persistence.Id;

@Entity // JPAê°€ ì¸ì‹
public class Member {

    @Id //JPAì—ê²Œ PK ì•Œë ¤ì£¼ê¸°
    private Long id;
    private String name;

    public Long getId() {
        return id;
    }
    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }
}
```

<br/><br/>

ğŸ“„JpaMain.java

```
package hellojpa;

public class JpaMain {
    public static void main(String[] args){

        // Entity manager factory ìƒì„±
        EntityManagerFactory emf = Persistence.createEntityManagerFactory("hello");

        // Entity manager ìƒì„±
        EntityManager em = emf.createEntityManager();

        // JPAì—ì„  íŠ¸ëœì­ì…˜ì„ í•´ì¤˜ì•¼ í•œë‹¤.
        EntityTransaction tx =  em.getTransaction();

        // íŠ¸ëœì­ì…˜ ì‹œì‘
        tx.begin();


        //íšŒì› ë“±ë¡
         Member member = new Member();
         member.setId(2L);
         member.setName("HelloB");

        //JPAì— ì €ì¥
         em.persist(member);

         //commit
         tx.commit

        // ê¼­ ë‹«ì•„ì£¼ê¸°
         em.close();
         emf.close();
}

```

- <span style="background-color:#E3F2FD">JPAì˜ ëª¨ë“  ë°ì´í„° ë³€ê²½ì€ íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ ì‘ì—…í•´ì•¼ í•œë‹¤.</span>

<br/><br/>

## CRUD

### ë“±ë¡

```
Member member = new Member();
member.setId(2L);
member.setName("HelloB");

```

### ì¡°íšŒ

```
Member findMember = em.find(Member.class, 1L);
```

### ìˆ˜ì •

```
findMember.setName("HelloJPA");
```

ìˆ˜ì •í•˜ê³  ë”°ë¡œ ì €ì¥ ì•ˆí•˜ê³  ê°’ë§Œ ë°”ê¾¸ë©´ ëœë‹¤.

### ì‚­ì œ

```
em.remove(findMember);
```

<br/><br/>

## â—ì£¼ì˜

- ì—”í‹°í‹° ë§¤ë‹ˆì € íŒ©í† ë¦¬: í•˜ë‚˜ë§Œ ìƒì„±í•´ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ì—ì„œ ê³µìœ í•œë‹¤.
- ì—”í‹°í‹° ë§¤ë‹ˆì €: ê³ ê°ì—ê²Œ ìš”ì²­ì´ ì˜¬ ë•Œë§ˆë‹¤ ì‚¬ìš©í•˜ê³  ë°”ë¡œ ë²„ë ¤ì•¼ í•˜ê¸° ë•Œë¬¸ì— ì“°ë ˆë“œ ê°„ì— ê³µìœ í•˜ë©´ ì•ˆ ëœë‹¤.

<br/><br/>

## JPQL

JPAëŠ” ì—”í‹°í‹° ê°ì²´ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ê°œë°œí•˜ë¯€ë¡œ SQLì„ ì‚¬ìš©í•˜ë©´ ì•ˆëœë‹¤.
ê·¸ëŸ¬ë‚˜ SQLì„ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ê²½ìš°ê°€ ìƒê¸°ëŠ”ë° ë°”ë¡œ ê²€ìƒ‰ ì¿¼ë¦¬ë¥¼ ì‚¬ìš©í•´ì•¼ í•  ë•Œì´ë‹¤.
JPAëŠ” ì—”í‹°í‹° ê°ì²´ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ê°œë°œí•˜ë¯€ë¡œ ê²€ìƒ‰í•  ë•Œë„ í…Œì´ë¸”ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê²€ìƒ‰í•´ì•¼ í•œë‹¤.
JPAëŠ” SQLì„ ì¶”ìƒí™”í•œ JPQLì´ë¼ëŠ” ê°ì²´ ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ë¥¼ ì œê³µí•œë‹¤.

- ì—”í‹°í‹° ê°ì²´ë¥¼ ëŒ€ìƒìœ¼ë¡œ ê²€ìƒ‰í•˜ëŠ” ì¿¼ë¦¬ì´ë‹¤.
- JPQLì€ SQLì„ ì¶”ìƒí™”í•œ ê°ì²´ ì§€í–¥ ì¿¼ë¦¬ ì–¸ì–´ì´ë‹¤.
